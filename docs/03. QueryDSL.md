# QueryDSL
- 엘라스틱서치에서 데이터를 찾고 구분하는 기능은 크게 쿼리와 필터를 이용한 방법으로 나뉨
- 쿼리와 필터는 모두 JSON 형식으로 구현하며 이를 QueryDSL(Domain Specific Language)이라고 함
- 쿼리와 필터는 각각 독립적인 요소로 실행
- 쿼리와 필터 문법은 어그리게이션(Aggregation)과 같은 API의 내부에서도 사용

![image](https://github.com/jaero0725/ElasticStack_Study/assets/55049159/2a1be2ec-dbeb-46f0-b4a6-a83ff75e4885)

#### 기본적인 형태소 분석 과정
- 대소문자 소문자 변환
- 중복 단어 제거
- 분석 과정을 거치고 저장된 토큰을 텀(term) 이라고함 
![image](https://github.com/jaero0725/ElasticStack_Study/assets/55049159/6cec185b-7626-4d8b-87eb-4330e7eefc8a)

#### 텀(term) 쿼리
- term 옵션을 사용
- 질의문이 저장된 텀과 정확히 일치하는 내용을 찾음

#### 텀즈(terms) 쿼리
- terms 옵션을 사용
- 2개 이상의 텀을 같이 검색할 경우 사용
- 텀즈 쿼리의 값은 항상 배열 형식으로 입력
- minimum_should_match 옵션을 사용하여 최소 일치 수 지정 가능

#### 매치 (Match), 멀티 매치 쿼리
- match 옵션을 사용
- 질의문 또한 형태소 분석을 거친 뒤 사용
- multi_match 옵션을 사용하여 여러 필드에서 검색 가능
- analyzer 옵션으로 원하는 형태소 분석 적용 가능
- operator 옵션으로 검색 연산자 지정 가능

#### 불(Bool) 쿼리
- 내부의 질의로 다른 쿼리를 포함시켜 사용
- 쿼리를 조건문인 불 조합으로 적용하여 최종 검색 결과를 나타냄

##### 불 쿼리에 사용할 수 있는 조건문
- must : 반드시 해당해야 하는 조건 (AND)
- must_not : 해당돼서는 안됨(NOT)
- Should : 반드시 해당될 필요는 없으나 해당될 경우 더 높은 스코어를 가짐

#### 문자열 쿼리
- URI 검색에서 q 매개변수에 사용하는 질의문 형태 사용 가능
-  {필드명} : {질의문} 형식으로 필드 지정 가능
- 검색 연산자 사용 가능
- 와일드 카드 사용 가능 (?, * 등)
- 비교적 가장 다양한 질의 구현 가능

#### 범위 쿼리
- range 옵션을 사용
- 필드는 숫자 또는 날짜/시간 형식 이어야함
- 날짜/시간은 날짜/시간은 JSON의 표준 날짜/시간 입력 형식이어야 함

##### 범위 쿼리에 사용되는 값
• gte(greater than or equal) : 주어진 값보다 크거나 같음 <br>
• gt(greater than) : 주어진 값보다 큼<br>
• lte(less than or equal) : 주어진 값보다 작거나 같음<br>
• lt(less than) : 주어진 값보다 작음<br>

#### 퍼지 쿼리
- 레벤슈타인 거리 알고리즘을 기반으로 유사 단어 검색 지원
- 숫자, 날짜 형식을 대상으로 범위 검색으로 응용 가능
- fuzziness 값으로 날짜를 입력할 경우 3d, 3y와 같은 날짜 심볼 사용

#### 필터
- 스코어를 계산하지 않으므로 쿼리에 비해 월등히 빠름
- 결과가 메모리에 캐싱 됨
- _cache 옵션을 사용하여 캐싱 여부 설정 가능
- 다른 필터나 쿼리, 어그리게이션 등의 처리에 사용
- 대부분의 옵션은 쿼리와 동일

### Q. term vs match 차이 
term : 정확하게 맞는 검색어 질의
- 주어진 필드에서 정확히 일치하는 용어를 검색합니다. 정확한 대소문자, 공백, 문장 부호를 모두 일치시켜야 함
- 분석기를 거치지 않으므로 검색어와 필드의 값이 정확하게 일치

match : 검색어 분석후 질의 
- 텍스트 검색을 위한 유연한 쿼리 유형
- 내부적으로 정의된 분석기를 통해 처리되어 분석되고 정규화
- 텍스트 분석기를 통해 검색어를 처리하므로, 필드의 값과 분석기 설정에 따라 검색 결과가 달라질 수 있다.
  
